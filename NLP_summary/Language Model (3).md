# Language Model (3)

Source: https://wikidocs.net/21695, https://wikidocs.net/21668, https://wikidocs.net/21687, https://wikidocs.net/21692, https://wikidocs.net/22533, https://wikidocs.net/21697, https://wikidocs.net/21681

---

### 4. 한국어에서의 언어 모델(Language Model for Korean Sentences)

영어나 기타 언어에 비해서 한국어는 언어 모델로 다음 단어를 예측하기가 훨씬 까다롭다.
한국어 NLP는 영어보다 훨씬 어렵다.

---

### 4.1 한국어는 어순이 중요하지 않다

한국어에서는 어순이 중요하지 않다.
그래서 이전 단어가 주어졌을 때, 다음 단억 나타날 확률을 구해야하는데 어순이 중요하지 않다는 것은 어떤 단어든 나타나도 된다는 의미이다.

예를 들어보자.

1. 나는 운동을 합니다 체육관에서.
2. 나는 체육관에서 운동을 합니다.
3. 체육관에서 운동을 합니다.
4. 나는 운동을 체육관에서 합니다.

4개의 문장은 전부 의미가 통하는 것을 볼 수 있다.
심지어 '나는'이라는 주어를 생략해도 말이 되어버린다.
이렇게 단어 순서를 뒤죽박죽으로 바꾸어놔도 한국어는 의미가 전달되기 때문에 확률에 기반한 언어 모델이 제대로 다음 단어를 예측하기가 어렵다.

---

### 4.2 한국어는 교착어이다

한국어는 교착어이다.
이는 한국어에서의 언어 모델 작동을 어렵게 만든다.
띄어쓰기 단위인 어절 단위로 토큰화를 할 경우에는 문장에서 발생가능한 단어의 수가 굉장히 늘어난다.
대표적인 예로 교착어인 한국어에는 조사가 있다.
영어는 기본적으로 조사가 없다.
하지만 한국어에서는 어떤 행동을 하는 동사의 주어나 목적어를 위해서 조사라는 것이 있다.

가령 '그녀'라는 단어 하나만 해도 그녀가, 그녀를, 그녀의, 그녀로, 그녀께서, 그녀처럼 등과 같이 다양한 경우가 존재한다.
그렇기 때문에, 한국어에서는 토큰화를 통해 접사나 조사 등을 분리하는 것은 중요한 작업이 되기도 한다.

---

### 4.3 한국어는 띄어쓰기가 제대로 지켜지지 않는다.

한국어는 띄어쓰기를 제대로 하지 않아도 의미가 전달되며, 띄어쓰기 규칙 또한 상대적으로 까다로운 언어이기 때문에 자NLP를 하는 것에 있어서 한국어 코퍼스는 띄어쓰기가 제대로 지켜지지 않는 경우가 많다.
토큰이 제대로 분리되지 않는채 훈련 데이터로 사용한다면, 언어 모델은 제대로 작동하지 않는다.

---

### 5. 펄플렉서티(Perplexity)

두 개의 모델 A, B가 있을 때 이 모델의 성능은 어떻게 비교할 수 있을까.
두 개의 모델을 오타 교정, 기계 번역 등의 평가에 투입해볼 수 있다.
그리고 두 모델이 해당 업무의 성능을 누가 더 잘했는지를 비교하면 된다.
그런데 두 모델의 성능을 비교하고자, 일일히 모델들에 대해서 실제 작업을 시켜보고 정확도를 비교하는 작업은 공수가 너무 많이 드는 작업이다.
만약 비교해야하는 모델이 두 개가 아니라 그 이상의 수라면 시간은 비교해야하는 모델의 수만큼 배로 늘어날 수 있다.

이러한 쳥가를 외부 평가(extrinsic evaluation)라고 하는데, 이러한 평가보다는 어쩌면 조금은 부정확할 수는 있어도 테스트 데이터에 대해서 빠르게 식으로 계산되는 더 간단한 방법이 있다.
바로 모델 내에서 자신의 성능을 수치화하여 결과를 내놓는 내부 평가(intrinsic evaluation)에 해당되는 펄플랙서티(perplexity)이다.

---

### 5.1 언어 모델의 평가 방법(Evaluation metric): PPL

펄플렉서티는 언어 모델을 평가하기 위한 내부 평가 지표이다.
보통 줄여서 PPL이라고 한다.
PPL은 수치가 높으면 좋은 성능을 의미하는 것이 아니라, 낮을수록 언어 모델의 성능이 좋다는 것을 의미한다.

PPL은 단어의 수로 정규화된 테스트 데이터에 대한 확률의 역수이다.
PPL을 최소화한다는 것은 문장의 확률을 최대화하는 것과 같다.
문장 W의 길이가 N이라고 했을 때, PPL은 다음과 같다.
$$
PPL(W)=P(w_{1}, w_{2}, w_{3}, ... , w_{N})^{-\frac{1}{N}}=\sqrt[N]{\frac{1}{P(w_{1}, w_{2}, w_{3}, ... , w_{N})}}
$$
문장의 확률에 체인룰(chain rule)을 적용하면 아래와 같다.
$$
PPL(W)=\sqrt[N]{\frac{1}{P(w_{1}, w_{2}, w_{3}, ... , w_{N})}}=\sqrt[N]{\frac{1}{\prod_{i=1}^{N}P(w_{i}| w_{1}, w_{2}, ... , w_{i-1})}}
$$
여기에 n-gram을 적용해볼 수도 있다.
예를 들어 bigram 언어 모델의 경우에는 식이 아래와 같다.
$$
PPL(W)=\sqrt[N]{\frac{1}{\prod_{i=1}^{N}P(w_{i}| w_{i-1})}}
$$

---

### 5.2 분기 계수(Branching factor)

PPL은 선택할 수 있는 가능한 경우의 수를 의미하는 분기계수이다.
PPL은 이 언어 모델이 특정 시점에서 평균적으로 몇 개의 선택지를 가지고 고민하고 있는지를 의미한다.
가령, 언어 모델은 테스트 데이터에 대해서 다음 단어를 예측하는 모든 시점(time-step)마다 평균적으로 10개의 단어를 가지고 어떤 것이 정답인지 고민하고 있다고 볼 수 있다.
같은 테스트 데이터에 대해서 두 언어 모델의 PPL을 각각 계산 후에 PPL의 값을 비교하면, 두 언어 모델 중 어떤 것의 성능이 더 좋은지도 판단이 가능하다.
당연히 PPL이 낮은 언어 모델의 성능이 더 좋다고 볼 수 있다.
$$
PPL(W)=P(w_{1}, w_{2}, w_{3}, ... , w_{N})^{-\frac{1}{N}}=(\frac{1}{10}^{N})^{-\frac{1}{N}}=\frac{1}{10}^{-1}=10
$$
단, 평가 방법에 있어서 주의할 점은 PPL의 값이 낮다는 것은 테스트 상에서 높은 정확도를 보인다는 것이지, 사람이 직접 느끼기에 좋은 언어 모델이라는 것을 반드시 의미하지는 않는다.
또한 언어 모델의 PPL은 테스트 데이터에 의존하므로 두 개 이상의 언어 모델을 비교할 때는 정량적으로 양이 많고, 또한 도메인에 알맞은 동일한 테스트 데이터를 사용해야 신뢰도가 높다는 것이다.

---

### 5.3 기존 언어 모델 VS 인공 신경망을 이용한 언어 모델

PPL의 실제 사용 사례를 확인해보자.
페이스북 AI 연구팀은 우리가 앞서 배운 n-gram 언어 모델과 이후 배우게 될 딥러닝을 이용한 언어 모델에 대해서 PPL로 성능 테스트를 한 표를 공개했었다.

![img](https://wikidocs.net/images/page/21697/ppl.PNG)

표에서 맨 위의 줄의 언어 모델이 n-gram을 이용한 언어 모델이며 PPL이 67.6.으로 측정되었다.
5-gram을 사용하였으며, 5-gram 앞에 Interpolated Kneser-Ney라는 이름이 붙었는데 이 책에서는 별도 설명을 생략하겠다고 했던 일반화 방법이 사용된 모델이다.
반면, 그 아래의 모델들은 인공 신경망을 이용한 언어 모델들로 페이스북 AI 연구팀이 자신들의 언어 모델을 다른 언어 모델과 비교하고자 하는 목적으로 기록했다.
인공신경망을 이용한 언어 모델들은 대부분 n-gram을 이용한 언어 모델보다 더 좋은 성능 평가를 받았음을 확인 할 수 있다.

---

### 6. 조건부 확률(Conditional Probability)

언어 모델(Language Model)과 n-gram의 근간이 되는 조건부 확률의 이해를 위해 작성하는 부록 개념의 예제 챕터이다.

![img](https://wikidocs.net/images/page/21681/%EC%A1%B0%EA%B1%B4%EB%B6%80_%ED%99%95%EB%A5%A0.PNG)

- A = 학생이 남학생인 사건
- B = 학생이 여학생인 사건
- C = 학생이 중학생인 사건
- D = 학생이 고등학생인 사건

이라고 했을 때, 아래의 확률을 계산해보자.

1. 학생을 뽑았을 때, 남학생일 확률
   $$
   P(A) =180/360=0.5
   $$
   

2. 학생을 뽑았을 때, 고등학생이면서 남학생일 확률
   $$
   P(A∩D)  = 80/360
   $$
   

3. 고등학생 중 한명을 뽑았을 때, 남학생일 확률
   $$
   P(A|D)  = 80/200 = P(A∩D)/P(D) = (80/360)/(200/360) = 80/200 = 0.4
   $$
   